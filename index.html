<html>
    <head>
        <style>
            .thermometer {
                position: relative;
                border-radius: 50px;
                border-color: black;
                border: 4px solid;
                height: 300px;
                width: 30px;
            }
            li {
                list-style-type: none;
                padding-left: 0px; /* for space between markings on the thermometer and labels */
            }
            li::before {
                content: '-';
                position: absolute;
                left: -6.5px;
                top: -1px;
                font-size: 1.1em;
            }
            .markings li {
                position: absolute;
                width: 70px;
                text-align: right;
            }

            .markings li:nth-child(1) {
                top: 4%
            }
            .markings li:nth-child(2) {
                top: 17%
            }
            .markings li:nth-child(3) {
                top: 30%
            }
            .markings li:nth-child(4) {
                top: 43%
            }
            .markings li:nth-child(5) {
                top: 56%
            }
            .markings li:nth-child(6) {
                top: 69%
            }
            .markings li:nth-child(7) {
                top: 82%
            }
            .glass {
                display: flex;
                position: absolute;
                top: 0%;
                flex-direction: column;
                height: 100%;
                width: 100%;    
                justify-content: flex-end;
            }
            .mercury {
                background-color: red;
                width: 100%;
                height: 15%;
                border-radius: 0 0 50px 50px;
            }
            .contentContainer {
                display: flex;
                flex-direction: row;
                /* background-color: mediumaquamarine; */
            }
            .inputRowsContainer {
                display: flex;
                flex-direction: column;
                /* background-color: palevioletred; */
                width: 500px;
            }
            .inputRow {
                display: flex;
                flex-direction: row;
                /* background-color: aquamarine; */
                gap: 10px;
                padding-bottom: 10px;
                align-items: baseline;
            }
            .inputRow label {
                width: 30%;
                /* background-color: brown; */
            }
            .inputRow span {
                width: 25%;
            }
            .resultContainer {
                padding: 10px 30px 10px 0;
                width: 150px;
                /* background-color: bisque; */
            }
            .outputColumn {
                display: flex;
                flex-direction: column;
                /* background-color: aquamarine; */
            }
        </style>
    </head>

    <div class="contentContainer">
        <div class="inputRowsContainer">
            <div class="inputRow">
                <label for="solarInput"> Solar intensity:</label>
                <input type="range" min="70" max="130" value="100" id="solarInput" oninput="update()">
                <span id="solarValue">
                </span>
            </div>  
            <div class="inputRow">
                <label for="albedoInput">Planet albedo:</label>
                <input type="range" min="0" max="100" value="30" id="albedoInput" oninput="update()">
                <span id="albedoValue">
                </span>
            </div>
            <div class="inputRow">
                <label for="absorbInput">Optical absorbance:</label>
                <input type="range" min="0" max="1000" value="105" id="absorbInput" oninput="update()">
                <span id="absorbValue">
                </span>
            </div>
            <div class="inputRow">
                <label for="emissInput">Infrared emissivity:</label>
                <input type="range" min="0" max="100" value="90" id="emissInput" oninput="update()">
                <span id="emissValue">
                </span>
            </div>
        </div>
        <div class="outputColumn">
            <div class="resultContainer">
                <b><span id="surfTempValue">
                </span></b>
            </div>
            <div class="thermoContainer">
                <div class="thermometer">
                    <ul class="markings">
                        <li>100 °C</li>
                        <li>50 °C</li>
                        <li>0 °C</li>
                        <li>-50 °C</li>
                        <li>-100 °C</li>
                        <li>-150 °C</li>
                        <li>-200 °C</li>
                    </ul>
                    <div class="glass">
                        <div id="surfaceTemp" class="mercury"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="outputColumn">
            <div class="resultContainer">
                <b><span id="atmTempValue">
                </span></b>
            </div>
            <div class="thermoContainer">
                <div class="thermometer">
                    <ul class="markings">
                        <li>100 °C</li>
                        <li>50 °C</li>
                        <li>0 °C</li>
                        <li>-50 °C</li>
                        <li>-100 °C</li>
                        <li>-150 °C</li>
                        <li>-200 °C</li>
                    </ul>
                    <div class="glass">
                        <div id="atmTemp" class="mercury"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function surfaceTemperature(albedo, solar, emissivity, absorbance){
            const sigma = 5.67e-8
            const aE = albedo * (1 - absorbance)**2
            const aPrime = (1 - absorbance) * (1 - albedo)
            const temp = Math.pow((solar*(1 - aE + aPrime))/(4 * sigma * (2-emissivity)), 0.25)
            const tempCelsius = temp - 273.15
            return tempCelsius
        }
        function atmosphericTemperature(albedo, solar, emissivity, absorbance){
            const surfTemp = surfaceTemperature(albedo, solar, emissivity, absorbance) + 273.15
            const surfTemp4 = Math.pow(surfTemp, 4)
            const sigma = 5.67e-8
            const aE = albedo * (1 - absorbance)**2
            const aPrime = (1 - absorbance) * (1 - albedo)
            const upper = 4 * sigma * surfTemp4 - solar * aPrime
            const lower = 4 * emissivity * sigma
            const temp = Math.pow((4 * sigma * surfTemp4 - solar * aPrime)/(4 * emissivity * sigma), 0.25)
            const tempCelsius = temp - 273.15
            return tempCelsius
        }
        function calcTemperaturePosition(temp, minTemp, maxTemp, positionMinTemp, positionMaxTemp){
            const diffToMin = temp - minTemp
            const diffMinMax = maxTemp - minTemp
            const diffPositionMinMax = positionMaxTemp - positionMinTemp
            const position = diffToMin / diffMinMax * diffPositionMinMax + positionMinTemp
            return position
        }
        console.log('atmTemp = ', atmosphericTemperature(0.3, 1360, 0.9, 0.105))
        function update(){
            let solarPercent = document.getElementById("solarInput").value
            document.getElementById("solarValue").innerHTML = solarPercent + " % of present"

            let albedo = document.getElementById("albedoInput").value / 100
            document.getElementById("albedoValue").innerHTML = albedo

            let absorbance = document.getElementById("absorbInput").value / 1000
            document.getElementById("absorbValue").innerHTML = absorbance

            let emissivity = document.getElementById("emissInput").value / 100
            document.getElementById("emissValue").innerHTML = emissivity

            let solar = 1360 * solarPercent / 100
            let surfTemp = surfaceTemperature(albedo, solar, emissivity, absorbance)
            document.getElementById("surfTempValue").innerHTML = "Surface<br \>temperature:<br \>" + Math.round(surfTemp * 10) / 10 + " °C"
            let atmTemp = atmosphericTemperature(albedo, solar, emissivity, absorbance)
            document.getElementById("atmTempValue").innerHTML = "Atmospheric<br \>temperature:<br \>" + Math.round(atmTemp * 10) / 10 + " °C"
            
            // TODO: make sure that ultimate temp borders are not in the possible ranges!
            let minTemp = -200
            let maxTemp = 100
            let positionMinTemp = 15
            let positionMaxTemp = 93
            let posSurfaceTemp = calcTemperaturePosition(surfTemp, minTemp, maxTemp, positionMinTemp, positionMaxTemp)
            document.getElementById("surfaceTemp").style.height = posSurfaceTemp + "%"
            let posAtmTemp = calcTemperaturePosition(atmTemp, minTemp, maxTemp, positionMinTemp, positionMaxTemp)
            document.getElementById("atmTemp").style.height = posAtmTemp + "%"
        }
        update()
    </script>   
</html>