<html>
    <head>
        <style>
            .thermometer {
                position: relative;
                border-radius: 50px;
                border-color: black;
                border: 4px solid;
                height: 300px;
                width: 30px;
            }
            li {
                list-style-type: none;
                padding-left: 0px; /* for space between markings on the thermometer and labels */
            }
            li::before {
                content: '-';
                position: absolute;
                left: -6.5px;
                top: -1px;
                font-size: 1.1em;
            }
            .markings li {
                position: absolute;
                width: 70px;
                text-align: right;
            }

            .markings li:nth-child(1) {
                top: 4%
            }
            .markings li:nth-child(2) {
                top: 17%
            }
            .markings li:nth-child(3) {
                top: 30%
            }
            .markings li:nth-child(4) {
                top: 43%
            }
            .markings li:nth-child(5) {
                top: 56%
            }
            .markings li:nth-child(6) {
                top: 69%
            }
            .markings li:nth-child(7) {
                top: 82%
            }
            .glass {
                display: flex;
                position: absolute;
                top: 0%;
                flex-direction: column;
                height: 100%;
                width: 100%;    
                justify-content: flex-end;
            }
            #mercury {
                background-color: red;
                width: 100%;
                height: 15%;
                border-radius: 0 0 50px 50px;
            }
            .contentContainer {
                display: flex;
                flex-direction: row;
                /* background-color: mediumaquamarine; */
            }
            .inputRowsContainer {
                display: flex;
                flex-direction: column;
                /* background-color: palevioletred; */
                width: 500px;
            }
            .inputRow {
                display: flex;
                flex-direction: row;
                /* background-color: aquamarine; */
                gap: 10px;
                padding-bottom: 10px;
                align-items: baseline;
            }
            .inputRow label {
                width: 30%;
                /* background-color: brown; */
            }
            .inputRow span {
                width: 25%;
            }
            .resultContainer {
                padding: 10px 0 10px 0;
                /* background-color: bisque; */
            }
            .outputColumn {
                display: flex;
                flex-direction: column;
            }
        </style>
    </head>

    <div class="contentContainer">
        <div class="inputRowsContainer">
            <div class="inputRow">
                <label for="albedoInput">Albedo:</label>
                <input type="range" min="0" max="100" value="30" id="albedoInput" oninput="update()">
                <span id="albedoValue">
                </span>
            </div>
            <div class="inputRow">
                <label for="solarInput"> Solar intensity:</label>
                <input type="range" min="1" max="200" value="100" id="solarInput" oninput="update()">
                <span id="solarValue">
                </span>
            </div>  
        </div>
        <div class="outputColumn">
            <div class="resultContainer">
                <b><span id="surfTempValue">
                </span></b>
            </div>
            <div class="thermoContainer">
                <div class="thermometer">
                    <ul class="markings">
                        <li>100 °C</li>
                        <li>50 °C</li>
                        <li>0 °C</li>
                        <li>-50 °C</li>
                        <li>-100 °C</li>
                        <li>-150 °C</li>
                        <li>-200 °C</li>
                    </ul>
                    <div class="glass">
                        <div id="mercury"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function surfaceTemperature(albedo, solar, emissivity, absorptivity){
            const sigma = 5.67e-8
            const aE = albedo * (1 - absorptivity)**2
            const aPrime = (1 - absorptivity) * (1 - albedo)
            const temp = Math.pow((solar*(1 - aE + aPrime))/(4 * sigma * (2-emissivity)), 0.25)
            const tempCelsius = temp - 273.15
            // console.log("sigma", sigma, "aE", aE, "aPrime", aPrime, "temp", temp)
            return tempCelsius
        }
        function calcTemperaturePosition(temp, minTemp, maxTemp, positionMinTemp, positionMaxTemp){
            const diffToMin = temp - minTemp
            const diffMinMax = maxTemp - minTemp
            const diffPositionMinMax = positionMaxTemp - positionMinTemp
            const position = diffToMin / diffMinMax * diffPositionMinMax + positionMinTemp
            return position
        }
        console.log('-200 = ', calcTemperaturePosition(-200, -200, 100, 15, 93))
        console.log('-150 = ', calcTemperaturePosition(-150, -200, 100, 15, 93))
        console.log('-100 = ', calcTemperaturePosition(-100, -200, 100, 15, 93))
        console.log('-50 = ', calcTemperaturePosition(-50, -200, 100, 15, 93))
        console.log('0 = ', calcTemperaturePosition(0, -200, 100, 15, 93))
        console.log('50 = ', calcTemperaturePosition(50, -200, 100, 15, 93))
        console.log('100 = ', calcTemperaturePosition(100, -200, 100, 15, 93))
        function update(){
            let albedo = document.getElementById("albedoInput").value / 100
            document.getElementById("albedoValue").innerHTML = albedo

            let solarPercent = document.getElementById("solarInput").value
            document.getElementById("solarValue").innerHTML = solarPercent + " % of sun"

            let solar = 1360 * solarPercent / 100
            let emissivity = 0.9
            let absorptivity = 0.105
            let surfTemp = surfaceTemperature(albedo, solar, emissivity, absorptivity)
            document.getElementById("surfTempValue").innerHTML = Math.round(surfTemp) + " °C surface temperature"
            
            // TODO: make sure that ultimate temp borders are not in the possible ranges!
            let minTemp = -200
            let maxTemp = 100
            let positionMinTemp = 15
            let positionMaxTemp = 93
            let posTemp = calcTemperaturePosition(surfTemp, minTemp, maxTemp, positionMinTemp, positionMaxTemp)
            document.getElementById("mercury").style.height = posTemp + "%"
        }
        update()
    </script>   
</html>